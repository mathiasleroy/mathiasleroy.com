<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>Machine Learning JavaScript Experiment</title><meta name="description" content="An experiment to apply machine learning, the k-nearest neighbors (KNN) algotithm, to movie ratings in order to predict film preferences"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="//brick.a.ssl.fastly.net/Raleway:200,400,500/Merriweather:200,400,200i" media="none" onload='"all"!=media&&(media="all")'><style type="text/css">body{font-family:Merriweather,serif;position:relative;line-height:1.5;margin-bottom:0;letter-spacing:.01rem;font-weight:200;font-style:normal;margin-bottom:90vh;color:#000;font-size:2em}.container{padding:50px}.btn,.headfont,button,dt,h1,h2,h3,h4,h5,h6{font-family:Raleway,sans-serif}#doorbell-button,.headfont{font-weight:400}h1{font-size:2.2em;margin-top:40px}h2{font-size:2em;line-height:1.2;margin-top:40px}p{margin-bottom:30px}.subtitle{margin-top:40px}.grey{opacity:.8}.small{font-size:.7em}.highlight{color:orange;font-weight:700}.hideAtStart{display:none}</style></head><body><div class="container" id="top"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2"><h1>Experimenting Machine Learning with JavaScript <small>&#151;applied to Movie Ratings</small></h1><br><dl class="dl-horizontal"><dt>Objective</dt><dd>Predict the rating of movies, based on previous ratings</dd><dt></dt><dd></dd><dt>Method</dt><dd><i>k</i>-nearest neighbors (KNN) regression</dd><dt></dt><dd class="small">(<i>k</i>-NN is a non-parametric method used for classification and regression. In both cases, the input consists of the <i>k</i> closest training examples in the feature space. In <i>k</i>-NN regression, the output is the average of the values of its k nearest neighbors. <a href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm" target="_blank">More on Wikipedia</a>)</dd><dt>Training Data</dt><dd>380 rated movies <span class="small">(or you can upload your IDMb movie ratings csv)</span></dd><dt>Features</dt><dd>IMDb Rating; Runtime (mins); Year; Num. Votes</dd><dt>Unlabeled Data</dt><dd>a list of 100 films <span class="small">(or you can upload your IDMb watchlist csv)</span></dd></dl><div id="1"><h2>1. Training Data</h2><p>Select the training dataset:</p><div class="row"><div class="col-md-6"><p><br><a class="btn btn-default btn-lg" href="javascript:_2();">Use the default data set</a></p></div><div class="col-md-6"><div class="form-group">or Select your IMDb ratings csv <input type="file" id="imdbcsv"><p><a class="small headfont" href="#" data-toggle="modal" data-target="#instructions">instructions</a></p></div></div></div><div class="modal fade" id="instructions" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">How to download your IMDb movie ratings?</h4></div><div class="modal-body"><small>This requires to have rated movies on IMDb.com</small><br><br><ol><li>Go to <a href="http://www.imdb.com/" target="_blank">imdb.com</a> & log in</li><li>Open the drop-down menu on your login name (top-right corner)</li><li>Click "Your Ratings"</li><li>Go to the bottom of this page</li><li>Click "Export this list"</li></ol></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div></div><div id="2" class="hideAtStart"><div class="alert alert-success" role="alert"><strong id="nmovies">453</strong> movie ratings successfully loaded!</div><h2>2. Features</h2><p>Select the features that could predict a movie rating:</p><p></p><form><div class="checkbox"><label><input id="imdbrating" type="checkbox" name="IMDb Rating" checked="true">IMDb Rating</label></div><div class="checkbox"><label><input id="runtime" type="checkbox" name="Runtime" checked="true">Runtime (mins)</label></div><div class="checkbox"><label><input id="year" type="checkbox" name="Year" checked="true">Year</label></div><div class="checkbox"><label><input id="numvotes" type="checkbox" name="Num. Votes" checked="true">Num. Votes</label></div><p id="options2"><a class="btn btn-default btn-lg" href="javascript:_3();">Use these features</a></p></form><p></p></div><div id="3" class="hideAtStart"><div class="alert alert-success" role="alert"><strong id="count_properties">3</strong> features successfully selected!</div><p></p><ol id="listproperties"></ol><p></p><h2>3. Unlabeled Data</h2><p>Select unrated movies to predict the rating:</p><div class="row"><div class="col-md-6"><p><br><a class="btn btn-default btn-lg" href="javascript:_4();">Use the default data set</a></p></div><div class="col-md-6"><div class="form-group">or Select your IMDb watchlist csv <input type="file" id="watchlistcsv"><p><a class="small headfont" href="#" data-toggle="modal" data-target="#instructions2">instructions</a></p></div></div></div></div><div class="modal fade" id="instructions2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel">How to download your IMDb watchlist?</h4></div><div class="modal-body"><small>This requires to have an IMDb.com account and rated movies</small><br><br><ol><li>Go to <a href="http://www.imdb.com/" target="_blank">imdb.com</a> & log in</li><li>Click "Watchlist"</li><li>Go to the bottom of this page</li><li>Click "Export this list"</li></ol></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><div id="4" class="hideAtStart"><div class="alert alert-success" role="alert"><strong id="nwatchlistmovies">xxx</strong> unrated movies successfully loaded! (<span id="nalreadyseen">xxx</span> were already in the training set)</div><h2>4. <i>K</i></h2><p>Select <i>K</i> (= number of nearest neighbours to look for):</p><form class="form-inline"><div class="form-group form-group-lg"><input type="number" class="form-control" id="K" value="3"></div><a class="btn btn-default btn-lg" href="javascript:_5();">Define <i>K</i></a></form><br></div><div id="5" class="hideAtStart"><div class="alert alert-success" role="alert"><i>K</i> successfully selected as <strong id="readK">xxx</strong>!</div><h2>5. Run the Algorithm Once</h2><br><table id="unseen" class="table"><tr><th>Title</th><th>IMDB Rating</th><th>Runtime</th><th>Year</th><th>Num. Votes</th><th>Prediction</th></tr><tr><td id="unseen-title"></td><td id="unseen-imdbrating"></td><td id="unseen-runtime"></td><td id="unseen-year"></td><td id="unseen-numvotes"></td><td id="unseen-prediction"></td></tr></table><p>The <span id="readK2">xxx</span> nearest neighbors:</p><table id="neighbors" class="table"><tr><th>Title</th><th>IMDB Rating</th><th>Runtime</th><th>Year</th><th>Num. Votes</th><th>You rated</th><th>Distance</th></tr></table><br><dl><dt>Distance formula <span class="small">= <a href="https://en.wikipedia.org/wiki/Euclidean_distance" target="_blank">Euclidian distance</a></span></dt><dd>$ \sqrt{(distance_1^2+distance_2^2+...+distance_k^2)} $</dd><dt>Normalization formula <span class="small">= <a href="https://en.wikipedia.org/wiki/Feature_scaling" target="_blank">Feature Scaling</a></span></dt><dd>$ distance_k = \frac{property_k(training) - property_k(unseen)}{range_k} $</dd></dl><p><a class="btn btn-default btn-lg" href="javascript:_6();">Show all predictions</a></p></div><div id="6" class="hideAtStart"><h2>6. All Predictions</h2><table class="table table-striped table-condensed" id="listunseen"><tr><th>Title</th><th>Predicted rating</th></tr><tr><td>Title</td><td>Predicted rating</td></tr><tr><td>Title</td><td>Predicted rating</td></tr></table></div><div id="7" class="hideAtStart"><br><p>Explore by Changing parameters (Training set, Unlabeled set, Features, <i>K</i>)</p><h3>Ressources</h3><p class="small"><a target="_blank" href="http://burakkanber.com/blog/machine-learning-in-js-k-nearest-neighbor-part-1/">Machine Learning in JS: k-nearest-neighbor Introduction</a><br><a target="_blank" href="https://github.com/NathanEpstein/KNear">NathanEpstein/KNear</a><br><a target="_blank" href="http://16cards.com/2013/06/06/knn-in-parse-cloud/">KNN using JavaScript and Underscore</a><br><a target="_blank" href="https://github.com/tonefolder/k-nearest-neighbor-js">tonefolder/k-nearest-neighbor-js</a><br><a target="_blank" href="https://homepages.thm.de/~admn12/pages/research/projectKNN.html">k-Nearest neighbour classifier as Java Script library</a><br><a target="_blank" href="https://www.npmjs.com/package/machine_learning">npm machine_learning library for Node.js</a></p><hr><p>made by <a href="http://mathiasleroy.com">Mathias Leroy</a></p></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script><script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>$("html, body").animate({scrollTop:0},500),stepsHaveRun=[0],console.log("step 1"),stepsHaveRun[1]=1,d3.csv("assets/data/ratings.csv",function(e,t){e&&console.log("Error loading ratings CSV"),window.data_ratings=t,processImdbData(window.data_ratings)}),d3.csv("assets/data/Movies100-V3.0.csv",function(e,t){e&&console.log("Error loading watchlist CSV"),t.forEach(function(e,t){e.title=e.Title,e.year=+e.Year,e.numvotes=+e.NumVotes,e.imdbid=e.imdbID,e.runtime=+e.Runtime,e.imdbrating=+e.imdbRating,delete e.Title,delete e.Year,delete e.Rating,delete e.NumVotes,delete e.imdbID,delete e.Runtime,delete e.imdbRating,delete e.Rating,delete e.Type,delete e.Released,delete e.Genres,delete e.Directors,delete e.Actors,delete e.Country,delete e.Metascore,delete e.imdbVotes,delete e.tomatoMeter,delete e.tomatoReviews,delete e.tomatoUserMeter,delete e.tomatoUserReviews,delete e.DVD,delete e.poster_path,delete e.release_date}),window.data_watchlist=t});var imdbcsvinput=document.getElementById("imdbcsv"),watchlistcsvinput=document.getElementById("watchlistcsv"),reader=new FileReader,reader2=new FileReader;function handleFiles(){var e=this.files[0];reader.readAsText(e)}function handleFiles2(){var e=this.files[0];reader2.readAsText(e)}function processImdbData(e){e.forEach(function(e,t){e.year=+e.Year,e.rating=+e["You rated"],e.imdbrating=+e["IMDb Rating"],e.numvotes=+e["Num. Votes"],e.runtime=+e["Runtime (mins)"],e.title=e.Title,e.imdbid=e.URL.replace("http://www.imdb.com/title/","").replace("/",""),delete e.Title,delete e.Year,delete e["You rated"],delete e["IMDb Rating"],delete e["Release Date (month/day/year)"],delete e.created,delete e["Num. Votes"],delete e["Runtime (mins)"],delete e["Title type"],delete e.Genres,delete e.Directors,delete e.URL,delete e.const,delete e.description,delete e.modified,delete e.position})}function _2(){stepsHaveRun[2]=1,console.log("step 2"),$("#2, #3, #4, #5, #6, #7").hide(),$("#nmovies").html(window.data_ratings.length),$("#2").show(),$("html, body").animate({scrollTop:$("#2").offset().top},500)}function _3(){if(stepsHaveRun[3]=1,console.log("step 3"),$("#3, #4, #5, #6, #7").hide(),window.properties=[],$("#imdbrating").prop("checked")&&window.properties.push("imdbrating"),$("#runtime").prop("checked")&&window.properties.push("runtime"),$("#year").prop("checked")&&window.properties.push("year"),$("#numvotes").prop("checked")&&window.properties.push("numvotes"),window.count_properties=window.properties.length,$("#count_properties").html(window.count_properties),$("#count_properties2").html(window.count_properties),0===window.count_properties)$("#3").hide(),$("html, body").animate({scrollTop:$("#2").offset().top},500);else{Array.prototype.clean=function(e){for(var t=0;t<this.length;t++)this[t]==e&&(this.splice(t,1),t--);return this},Array.maxProp=function(e,t){var i=e.map(function(e){return e[t]});return i.clean(0),[Math.min.apply(Math,i),Math.max.apply(Math,i)]},$("#listproperties").html(""),window.ranges=[];for(var e=0;e<window.count_properties;e++){var t=Array.maxProp(window.data_ratings,window.properties[e]);switch(window.ranges[window.properties[e]]=t,window.properties[e]){case"imdbrating":displayProperty="IMDB Rating";break;case"runtime":displayProperty="Runtime (mins)";break;case"year":displayProperty="Year";break;case"numvotes":displayProperty="Num. Votes";break;default:displayProperty="unk"}$("#listproperties").append("<li>"+displayProperty+' <span class="small grey">[min='+t[0]+" ; max="+t[1]+" ; range="+(t[1]-t[0])+"]</span></li>")}$("#3").show(),$("html, body").animate({scrollTop:$("#3").offset().top},500)}}function _4(){stepsHaveRun[4]=1,console.log("step 4"),$("#4, #5, #6, #7").hide();var e=window.data_watchlist.length;window.data_watchlist.forEach(function(e,n,a){var r=e.imdbid;window.data_ratings.forEach(function(e,t){var i=e.imdbid;r===i&&a.splice(n,1)})});var t=window.data_watchlist.length;$("#nwatchlistmovies").text(window.data_watchlist.length),$("#nalreadyseen").text(e-t),$("#4").show(),$("html, body").animate({scrollTop:$("#4").offset().top},500)}function _5(){stepsHaveRun[5]=1,console.log("step 5"),$("#5, #6, #7").hide(),window.K=1,window.K=$("#K").val(),$("#readK").text(window.K),$("#readK2").text(window.K);var e=window.data_ratings.length;window.count_unrated=window.data_watchlist.length;for(var t=window.count_unrated;t--;){for(var i=window.data_watchlist[t],n=e;n--;){for(var a=window.data_ratings[n],r=[],o=window.count_properties;o--;){var s=window.properties[o];r.push(Math.abs(((a[s]-i[s])/(window.ranges[s][1]-window.ranges[s][0])).toPrecision(6)))}var d=0;for(o=window.count_properties;o--;)d+=r[o]*r[o];var l=Math.sqrt(d);a.distance=l}function p(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0}window.data_ratings.sort(p);var w=0;for(o=0;o<window.K;o++)w+=window.data_ratings[o].rating;var c=w/window.K;if(i.rating=+c.toPrecision(6),0===t){console.log(r),$("#unseen-title").text(i.title),$("#unseen-imdbrating").text(i.imdbrating),$("#unseen-runtime").text(i.runtime),$("#unseen-year").text(i.year),$("#unseen-numvotes").text(i.numvotes),$("#unseen-prediction").html('<span class="highlight">'+c.toPrecision(3)+"</span>"),$("#neighbors").html(""),$("#neighbors").html('<tr id="neighbors-header"><th>Title</th>');for(var h=0;h<window.count_properties;h++){var u;switch(window.properties[h]){case"imdbrating":u="IMDB Rating";break;case"runtime":u="Runtime (mins)";break;case"year":u="Year";break;case"numvotes":u="Num. Votes";break;default:u="unk"}$("#neighbors th:last").after("<th>"+u+"</th>")}$("#neighbors th:last").after("\t\t\t\t\t\t\t<th>Distance</th>\t\t\t\t\t\t\t<th>Rating</th>\t\t\t\t\t\t</tr>");for(var m=0;m<K;m++){$("#neighbors").append('<tr id="neighbor-'+m+'"></tr>'),(a=$("#neighbor-"+m)).append('<td id="neighbor-'+m+'-title"></td>'),$("#neighbor-"+m+"-title").text(window.data_ratings[m].title);for(h=0;h<window.count_properties;h++)a.append('<td id="neighbor-'+m+"-"+window.properties[h]+'"></td>'),$("#neighbor-"+m+"-"+window.properties[h]).text(window.data_ratings[m][window.properties[h]]);a.append('<td id="neighbor-'+m+'-distance"></td>'),a.append('<td id="neighbor-'+m+'-rating"></td>'),$("#neighbor-"+m+"-distance").text(window.data_ratings[m].distance.toPrecision(2)),$("#neighbor-"+m+"-rating").text(window.data_ratings[m].rating)}}}$("#5").show(),$("html, body").animate({scrollTop:$("#5").offset().top},500)}function _6(){stepsHaveRun[6]=1,console.log("step 6"),$("#6, #7").hide(),stepsHaveRun[6]=1,window.data_watchlist.sort(function(e,t){return e.rating<t.rating?-1:e.rating>t.rating?1:0});var e=$("#listunseen tbody");e.html("");for(var t=window.count_unrated;t--;)e.append(" <tr> <td>"+window.data_watchlist[t].title+"</td> <td>"+window.data_watchlist[t].rating.toPrecision(3)+"</td> </tr>");$("#7").show(),$("#6").show(),$("html, body").animate({scrollTop:$("#6").offset().top},500)}imdbcsvinput.addEventListener("change",handleFiles,!1),watchlistcsvinput.addEventListener("change",handleFiles2,!1),reader.onload=function(e){var t=e.target.result;window.data_ratings=d3.csv.parse(t),'"position","const","created","modified","description","Title","Title type","Directors","You rated","IMDb Rating","Runtime (mins)","Year","Genres","Num. Votes","Release Date (month/day/year)","URL"'===this.result.split("\n")[0]?(processImdbData(window.data_ratings),_2()):alert("ERROR: The ratings file is not correct.")},reader2.onload=function(e){var t=e.target.result;window.data_watchlist=d3.csv.parse(t),'"position","const","created","modified","description","Title","Title type","Directors","You rated","IMDb Rating","Runtime (mins)","Year","Genres","Num. Votes","Release Date (month/day/year)","URL"'===this.result.split("\n")[0]?(processImdbData(window.data_watchlist),_4()):alert("ERROR: The watchlist file is not correct.")}</script><script>window.doorbellOptions={appKey:"0b29Vs0Vl2thf8Mtx10v5AuIKmJnF18lc2q6WiBWjawlJRRLRilCvGGbLIi1Izts"},function(e,t){var a=e.createElement("script");a.id="doorbellScript",a.type="text/javascript",a.async=!0,a.src="https://doorbell.io/button/843",(e.getElementsByTagName("head")[0]||e.getElementsByTagName("body")[0]).appendChild(a)}(document),-1<document.location.hostname.search("mathiasleroy.com")&&(!function(e,t,a,n,o,c,l){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=t.createElement(a),l=t.getElementsByTagName(a)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",l.parentNode.insertBefore(c,l)}(window,document,"script",0,"ga"),ga("create","UA-8990529-8","auto"),ga("send","pageview"))</script></body></html>